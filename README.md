# RSE/RSN Calculator\n\n> Calculateur de conformitÃ© des temps de conduite et de repos pour le transport routier.\n> RÃ©glementation europÃ©enne CE 561/2006, Code des transports franÃ§ais (L3312-1/2), DÃ©cret 2010-855.\n\n## Statut\n\n| Ã‰lÃ©ment | Valeur |\n|---------|--------|\n| Backend | v6.1.0 |\n| Frontend | v6.0.0 |\n| Tests automatisÃ©s | **131/131 (100%)** |\n| Couverture rÃ©glementaire | 100% |\n| Demo | [rse-rsn-calculator.onrender.com](https://rse-rsn-calculator.onrender.com/) |\n\n## Tests QA â€” 4 niveaux\n\n| Niveau | Endpoint | Tests | Description |\n|--------|----------|-------|-------------|\n| N1 â€” RÃ©glementaire | `GET /api/qa` | 56 | Assertions sur CE 561/2006, L3312-1, R3315-10/11, seuils, sanctions, pays |\n| N2 â€” Cas rÃ©els | `GET /api/qa/cas-reels` | 25 | ScÃ©narios terrain : conduite longue, nuit, multi-jours, repos fractionnÃ©s |\n| N3 â€” Limites | `GET /api/qa/limites` | 21 | Tests aux bornes sur 7 seuils rÃ©glementaires |\n| N4 â€” Robustesse | `GET /api/qa/robustesse` | 29 | Edge cases, inputs malformÃ©s, CSV vides, sÃ©quences absurdes |\n| **Total** | | **131** | **100% de rÃ©ussite** |\n\n## Types d'activitÃ© tachygraphe\n\nSymboles conformes au rÃ¨glement CE 3821/85 Annexe IB et rÃ¨glement 165/2014.\n\n| Code | ActivitÃ© | Symbole | Couleur | RÃ©glementation |\n|------|----------|---------|---------|----------------|\n| `C` | Conduite | Volant | ðŸŸ¢ | CE 561/2006 Art.6 â€” temps de conduite |\n| `T` | Autre tÃ¢che | Marteaux croisÃ©s | ðŸ”µ | Directive 2002/15/CE Art.3(a) â€” travail hors conduite |\n| `D` | DisponibilitÃ© | CarrÃ© barrÃ© (/) | ðŸŸ  | Directive 2002/15/CE Art.3(b) â€” attente, couchette vÃ©hicule en mouvement |\n| `P` | Pause | Lit | ðŸŸ£ | CE 561/2006 Art.7 â€” pause obligatoire 45 min aprÃ¨s 4h30 |\n| `R` | Repos | Lit (plein) | âš« | CE 561/2006 Art.8 â€” repos journalier 11h (9h rÃ©duit) |\n| `O` | Hors champ (OUT) | Cercle barrÃ© | ðŸŸ¤ | CE 561/2006 Art.9Â§3 â€” vÃ©hicule hors scope, suspend le calcul |\n| `F` | Ferry / Train | Bateau | ðŸ”µ | CE 561/2006 Art.9Â§1 â€” repos interruptible 2x max (1h total), couchette requise |\n\n## Sources rÃ©glementaires\n\n- [CE 561/2006 (EUR-Lex, version consolidÃ©e 31.12.2024)](https://eur-lex.europa.eu/legal-content/EN/TXT/HTML/?uri=CELEX:02006R0561-20241231)\n- [Code des transports L3312-1 (LÃ©gifrance)](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000023083578)\n- [DÃ©cret 2010-855 (LÃ©gifrance)](https://www.legifrance.gouv.fr/loda/id/JORFTEXT000022498530)\n- [RÃ¨glement 165/2014 â€” tachygraphe (EUR-Lex)](https://eur-lex.europa.eu/legal-content/EN/AUTO/?uri=celex:32014R0165)\n- [CE 3821/85 Annexe IB â€” symboles tachygraphe](https://eur-lex.europa.eu/legal-content/EN/ALL/?uri=CELEX:31985R3821)\n- [Guide du temps de travail (MinistÃ¨re)](https://travail-emploi.gouv.fr/droit-du-travail/la-duree-du-travail)\n- [EC Guidance Note 6 â€” Ferry/Train (Commission)](https://transport.ec.europa.eu/document/download/0084e7e3-abd9-4e0d-afc1-aa1dcd49621f_en)\n\n## API REST\n\n| MÃ©thode | Route | Description |\n|---------|-------|-------------|\n| `POST` | `/api/analyze` | Analyse de conformitÃ© (JSON ou CSV) |\n| `GET` | `/api/health` | Ã‰tat du serveur et version |\n| `GET` | `/api/qa` | Tests N1 â€” Assertions rÃ©glementaires (56) |\n| `GET` | `/api/qa/cas-reels` | Tests N2 â€” Cas rÃ©els (25) |\n| `GET` | `/api/qa/limites` | Tests N3 â€” Tests aux limites (21) |\n| `GET` | `/api/qa/robustesse` | Tests N4 â€” Robustesse (29) |\n| `GET` | `/api/regles` | RÃ¨gles rÃ©glementaires complÃ¨tes |\n| `GET` | `/api/pays` | Liste des 29 pays supportÃ©s |\n\n## Format CSV\n\n```\nDATE;HEURE_DEBUT;HEURE_FIN;TYPE_ACTIVITE\n2025-01-15;06:00;08:30;C\n2025-01-15;08:30;09:15;P\n2025-01-15;09:15;11:45;C\n2025-01-15;11:45;12:00;T\n2025-01-15;12:00;15:00;O\n2025-01-15;15:00;23:00;F\n```\n\nTypes : `C` (Conduite), `T` (Autre tÃ¢che), `D` (DisponibilitÃ©), `P` (Pause), `R` (Repos), `O` (Hors champ/OUT), `F` (Ferry/Train).\n\n## RÃ¨gles Ferry/Train (CE 561/2006 Art.9)\n\nLe moteur applique les rÃ¨gles suivantes pour les traversÃ©es ferry/train :\n\n- Le repos journalier normal ou le repos hebdomadaire rÃ©duit peut Ãªtre interrompu max **2 fois**\n- Le total des interruptions ne doit pas excÃ©der **1 heure**\n- Le conducteur doit avoir accÃ¨s Ã  une **couchette/cabine**\n- Pour le repos hebdomadaire : ferry programmÃ© **â‰¥ 8 heures** + accÃ¨s couchette\n- Le temps ferry avec couchette est comptabilisÃ© comme **repos** (pas travail/disponibilitÃ©)\n- Source : [RÃ¨glement 2020/1054 modifiant Art.9](https://eur-lex.europa.eu/legal-content/EN/AUTO/?uri=celex:32020R1054)\n\n## RÃ¨gles Hors champ / OUT (CE 561/2006 Art.9Â§3)\n\n- Le temps OUT ne compte **ni en conduite, ni en travail, ni en repos**\n- Conduire un vÃ©hicule hors scope pour rejoindre un vÃ©hicule soumis = **autre tÃ¢che** (Art.9Â§3)\n- Le calcul des seuils rÃ©glementaires est **suspendu** pendant les pÃ©riodes OUT\n\n## Architecture frontend v6.0.0\n\nLe frontend a Ã©tÃ© refactorÃ© d'un monolithe de 1182 lignes (App.jsx) vers 46 fichiers modulaires :\n\n```\nclient/src/\nâ”œâ”€â”€ App.jsx                          # Shell minimal (21 lignes)\nâ”œâ”€â”€ main.jsx                         # Point d'entrÃ©e React\nâ”œâ”€â”€ config/constants.js              # Configuration centralisÃ©e (7 types activitÃ©)\nâ”œâ”€â”€ hooks/\nâ”‚   â”œâ”€â”€ useServerHealth.js           # Polling santÃ© serveur\nâ”‚   â”œâ”€â”€ useAnalysis.js               # Appel API /analyze\nâ”‚   â”œâ”€â”€ useLocalStorage.js           # Persistance historique\nâ”‚   â””â”€â”€ useTheme.js                  # ThÃ¨me clair/sombre\nâ”œâ”€â”€ utils/\nâ”‚   â”œâ”€â”€ time.js                      # Conversion horaires\nâ”‚   â”œâ”€â”€ stats.js                     # Calculs statistiques\nâ”‚   â””â”€â”€ csv.js                       # Parsing et validation CSV (7 types)\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ common/                      # Button, Card, Badge, Loader + CSS Modules\nâ”‚   â”œâ”€â”€ icons/TachyIcons.jsx         # IcÃ´nes SVG tachygraphe officielles\nâ”‚   â”œâ”€â”€ gauges/                      # JaugeCirculaire, JaugeLineaire, PanneauJauges\nâ”‚   â”œâ”€â”€ timeline/Timeline24h.jsx     # Frise chronologique 24h\nâ”‚   â”œâ”€â”€ forms/                       # ParametresPanel, JourFormulaire, CsvInput\nâ”‚   â”œâ”€â”€ results/                     # ResultPanel, InfractionCard, RecommandationList, SanctionTable\nâ”‚   â””â”€â”€ layout/                      # Header, Footer, Onboarding\nâ”œâ”€â”€ styles/\nâ”‚   â””â”€â”€ global.css                   # Reset, animations, responsive\nâ””â”€â”€ pages/Calculator.jsx             # Page principale (185 lignes)\n```\n\nChoix techniques : pas de librairie UI externe, CSS Modules, React hooks natifs, Vite comme bundler.\nBundle : 184 KB JS (59 KB gzip) + 28 KB CSS (5.7 KB gzip).\n\n## Stack technique\n\n| Composant | Technologie |\n|-----------|-------------|\n| Backend | Node.js + Express |\n| Frontend | React 18 + Vite 5 |\n| Styles | CSS Modules |\n| IcÃ´nes | SVG tachygraphe (CE 3821/85) |\n| DÃ©ploiement | Render (free tier) |\n| Tests | QA intÃ©grÃ© (4 niveaux, 131 tests) |\n\n## Installation locale\n\n```bash\ngit clone https://github.com/Duperopope/rse-rsn-calculator.git\ncd rse-rsn-calculator\nnpm install\ncd client && npm install && npx vite build && cd ..\nnode server.js\n# Ouvrir http://localhost:3001\n```\n\n## Changelog\n\n### v6.1.0 â€” IcÃ´nes tachygraphe + OUT/FERRY (2025-02-12)\n- IcÃ´nes SVG conformes aux symboles officiels du chronotachygraphe\n- Sources : CE 3821/85 Annexe IB, RÃ¨glement 165/2014\n- Volant (conduite), marteaux croisÃ©s (autre tÃ¢che), barre oblique (disponibilitÃ©), lit (repos)\n- Ajout type OUT (O) â€” hors champ CE 561/2006 Art.9Â§3\n- Ajout type FERRY (F) â€” traversÃ©e ferry/train CE 561/2006 Art.9Â§1\n- Moteur : logique Art.9 (interruption repos max 2x/1h, couchette)\n- 7 types d'activitÃ© supportÃ©s (C, T, D, P, R, O, F)\n- 131/131 tests QA (0 rÃ©gression)\n\n### v6.0.0 â€” Frontend modulaire (2025-02-12)\n- Refonte complÃ¨te du frontend : 1182 lignes â†’ 46 fichiers modulaires\n- App.jsx rÃ©duit Ã  21 lignes (shell minimal)\n- CSS Modules pour tous les composants\n- Hooks personnalisÃ©s : useServerHealth, useAnalysis, useLocalStorage, useTheme\n- Bundle optimisÃ© : 182 KB JS + 28 KB CSS\n- Onboarding interactif avec 3 Ã©tapes\n\n### v5.7.4 â€” Stabilisation QA\n- Correction gÃ©nÃ©ration CSV (newlines)\n- 102/102 tests N1-N3 passent\n- Ajout niveau N4 robustesse (29 tests)\n\n### v5.7.3 â€” DÃ©tection nuit et service\n- Correction dÃ©tection service de nuit\n- Ajustements seuils repos rÃ©duit\n\n### v5.7.0 â€” QA Niveau 1\n- PremiÃ¨re batterie de 56 assertions rÃ©glementaires\n- Moteur de calcul initial CE 561/2006\n\n## Auteur\n\nSamir Medjaher â€” [GitHub](https://github.com/Duperopope)\n\n## Licence\n\nMIT